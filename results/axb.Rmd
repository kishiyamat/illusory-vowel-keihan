---
title: "axb"
output: html_notebook
---

1. 被験者ごとのデータをまとめる
  * 産出課題: 無声化率(環境毎)
  * 近畿の居住年数
1. 被験者ごとのデータをまとめる
  * 無声化
    * AXB
    * 判定課題
  * トーンの復元

```{r}
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(tidyr)
```

## 被験者情報

* `run_id`: cognition.run が割り振った番号
* `subject_id`: 実験実施者から与えられた番号
* `span_tokyo`: 東京の居住歴
* `span_kinki`: 近畿で居住歴

```{r}
# pilot_runid <- c(3, 8, 10, 11)
pilot_runid <- c()
illusory_vowel_keihan <- read_csv("illusory-vowel-keihan.csv") %>%
  filter(!run_id %in% pilot_runid) %>%
  filter(task != "production")

runid_subject <-
  illusory_vowel_keihan %>%
  filter(trial_type == "survey-html-form") %>%
  select(c(run_id, response)) %>%
  mutate(
    "key" = str_extract(response, "[a-z_]+"),
    "value" = as.numeric(str_extract(response, "[0-9]+"))
  ) %>%
  select(-response) %>%
  pivot_wider(names_from = key, values_from = value)

illusory_vowel_keihan <- merge(illusory_vowel_keihan, runid_subject, on = "item_id")
head(illusory_vowel_keihan)
print(unique(illusory_vowel_keihan$run_id))
print(unique(illusory_vowel_keihan$subject_id))
```

タスクの確認

item_id がないのは練習問題

* production
* axb
  * item_id でタスクが分かれる
* cat
  * item_id でタスクが分かれる
* rate(音としてどれくらい良いか)
  * item_id でタスクが分かれる

```{r}
unique(illusory_vowel_keihan$task)
# head()
# filter(task == "axb") %>%
```

```{r}
# illusory_vowel_keihan <-
axb_results <- illusory_vowel_keihan %>%
  filter(task == "axb") %>%
  select(c(run_id, item_id, is_correct, rt, span_kinki)) %>%
  mutate(item_id = as.numeric(item_id)) %>%
  mutate(rt = as.numeric(rt)) %>%
  mutate(item_id = as.numeric(item_id)) %>%
  mutate(is_correct = is_correct == "true") %>%
  drop_na()

axb_results
```

## ABX

### 無声化

https://docs.google.com/document/d/1OKkkZ4sELLtTBjiBWUG_P37EsWdFsidrGv0eOqiwIic/edit?usp=sharing

```{r}
# 文脈などのカラムをひっぱるのも可能
# type==target が 無声化, filler がトーンの知覚
item_list <- read_csv("../src/list/axb_list.csv") %>% select(c(item_id, type, condition, correct))
axb_results_devoice <- merge(axb_results, item_list, on = "item_id") %>% filter(type == "target")
axb_results_devoice
```

a を違うと早とちりするとこうなる。

```{r}
axb_results_devoice %>%
  mutate(span_kinki = span_kinki > 5) %>%
  ggplot() +
  facet_grid(correct ~ span_kinki) +
  geom_histogram(aes(x = condition, color = is_correct, fill = is_correct), stat = "count", position = "fill")
```

### トーン

https://docs.google.com/document/d/1rk5MHMvD5-6SWT7H2nkc-r7v3KvH-dzt_OdftNrDe-I/edit?usp=sharing

```{r}
# 文脈などのカラムをひっぱるのも可能
# type==target が 無声化, filler がトーンの知覚
item_list <- read_csv("../src/list/axb_list.csv") %>% select(c(item_id, type, correct, pitch_a, pitch_b))
axb_results_tone <- merge(axb_results, item_list, on = "item_id") %>% filter(type != "target")
axb_results_tone <- axb_results_tone %>%
  mutate(
    tone = case_when(
      correct == "a" ~ pitch_b,
      correct == "b" ~ pitch_a
    )
  ) %>%
  mutate(is_tokyo = case_when(
    tone == "-HL" ~ 1,
    tone == "-LL" ~ 0,
    tone == "-HLL" ~ 1,
    tone == "-HHL" ~ 0,
    tone == "-LHH" ~ 1,
    tone == "-LLH" ~ 0
  ))
head(axb_results_tone)
```

```{r}
axb_results_tone %>%
  mutate(span_kinki = span_kinki > 5) %>%
  ggplot() +
  facet_wrap(run_id ~ span_kinki) +
  geom_histogram(aes(x = is_tokyo, color = is_correct, fill = is_correct), stat = "count", position = "fill")
```

```{r}
axb_results_tone %>%
  mutate(span_kinki = span_kinki > 5) %>%
  ggplot() +
  facet_wrap(correct ~ span_kinki) +
  geom_histogram(aes(x = is_tokyo, color = is_correct, fill = is_correct), stat = "count", position = "fill")
```

```{r}
axb_results_tone %>%
  mutate(span_kinki = span_kinki > 5) %>%
  ggplot() +
  facet_wrap(correct ~ span_kinki) +
  geom_histogram(aes(x = tone, color = is_correct, fill = is_correct), stat = "count", position = "fill")
```

```{r}
axb_results_tone 
```


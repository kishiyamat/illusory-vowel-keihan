---
title: "subject_info"
output: html_document
---

* 被験者情報の取得
  * 被験者ごと
  * 被験者:アイテム
* 無声化率の可視化・分析
  * `無声化率 ~ 東京方言への接触 + n_mora + is_onset + is_HL`
    * `mora`: モーラ数
    * `mora_dur`: モーラの時間(無声化するかで変わってしまうので却下)
  * 東京方言への接触は複数のパターンで示せる
    * span_tokyo
    * span_tokyo - span_kinki
    * span_tokyo / age
    * (span_tokyo - span_kinki) / age

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(tidyr)
source("src/subject_info.R")
```

```{r}
annotation <- read_csv("devoicing_annotation.csv") %>% results_table()

# 曽根さん実験
order_sone <- read_csv("csv/illusory-vowel-keihan.csv") %>% order_by_run_id()
subject_info_sone <- read_csv("csv/illusory-vowel-keihan.csv") %>% extract_columns(data_src = "sone")
results_sone <- annotation %>%
  inner_join(subject_info_sone) %>%
  left_join(order_sone)

# クラウドワークス実験
order_cw <- read_csv("csv/illusory-vowel-keihan-cw.csv") %>% order_by_run_id()
subject_info_cw <- read_csv("csv/illusory-vowel-keihan-cw.csv") %>% extract_columns(data_src = "cw")
results_cw <- annotation %>%
  inner_join(subject_info_cw) %>%
  left_join(order_cw)

# マージ + devoiced のカラムを追加
results <- rbind(results_sone, results_cw) %>% 
  mutate(devoiced= 1- voiced)
```

```{r}
results_mean_by_item <- results %>%
  group_by(subj_id, item_id) %>%
  mutate(voiced = mean(voiced), 
         devoiced = mean(devoiced)) %>%
  ungroup() %>%
  select(-c(production_order)) %>%
  distinct()
```
```{r}
head(results_mean_by_item)
summary(results_mean_by_item)
```


```{r}
# kinkiの在住歴
results_mean_by_item %>%
  ggplot() +
  facet_wrap(. ~ item_id) +
  geom_point(aes(x = span_kinki / age, y = devoiced))

# tokyoの在住歴
results_mean_by_item %>%
  ggplot() +
  facet_wrap(. ~ item_id) +
  geom_point(aes(x = span_tokyo / age, y = devoiced))

# dominance
results_mean_by_item %>%
  ggplot() +
  facet_wrap(. ~ item_id) +
  geom_point(aes(x = span_kinki - span_tokyo, y = devoiced))

# dominance/年齢
results_mean_by_item %>%
  ggplot() +
  facet_wrap(. ~ item_id) +
  geom_point(aes(x = (span_kinki - span_tokyo) / age, y = devoiced))
```

```{r}
# dominance
results_mean_by_item %>%
  ggplot() +
  geom_point(aes(x = span_kinki - span_tokyo, y = devoiced, color=as.factor(item_id)))
```


```{r}
results_mean_by_subject <- results %>%
  group_by(subj_id) %>%
  mutate(voiced = mean(voiced),
         devoiced = mean(devoiced)) %>%
  ungroup() %>%
  select(-c(production_order, item_id, present_order)) %>%
  distinct() %>% drop_na()

results_mean_by_subject  # トーンの分析にはこれを使う
results_mean_by_subject %>%
  ggplot() +
  geom_point(aes(x = span_kinki - span_tokyo, y = devoiced))
```

傾向くらいはありそう。

TODO

* 1や2ではなく単語にして可視化
* これらを要因としてトーンの分析を再実施す
* なんならここで統計分析に書けても良い

```{r}
print("EOF")
```

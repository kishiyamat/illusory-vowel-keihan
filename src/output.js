var list_audio_preload = ['audio_33.mp3','audio_32.mp3','ebuzo-1.wav','etsu-HL-1.wav','etsto-L_H-1.wav','es-L-1.wav','esuko-LHH-1.wav','epso-1.wav','edzgo-1.wav','etsuto-HLL-1.wav','ezubo-1.wav','etsuko-1.wav','esuko-LLH-1.wav','ebzo-1.wav','etsuto-HHL-1.wav','ekto-1.wav','etsu-LL-1.wav','esko-L_H-1.wav','ets-L-1.wav','ekuto-1.wav','esu-HL-1.wav','etsuto-H_L-1.wav','esko-H_L-1.wav','egudo-1.wav','ezbo-1.wav','etsuto-LHH-1.wav','epuso-1.wav','esupo-1.wav','esuko-HLL-1.wav','etsuto-LLH-1.wav','esuko-HHL-1.wav','etsko-1.wav','espo-1.wav','egdo-1.wav','esu-LL-1.wav'];
var perception_list = [{'task': 'perception', 'item_id': 1, 'type': 'target', 'a': 'espo-1.wav', 'x': 'espo-1.wav', 'b': 'esupo-1.wav', 'correct': 'a', 'item_a': 'espo', 'item_x': 'espo', 'item_b': 'esupo'},{'task': 'perception', 'item_id': 2, 'type': 'target', 'a': 'esupo-1.wav', 'x': 'espo-1.wav', 'b': 'espo-1.wav', 'correct': 'b', 'item_a': 'esupo', 'item_x': 'espo', 'item_b': 'espo'},{'task': 'perception', 'item_id': 3, 'type': 'target', 'a': 'esupo-1.wav', 'x': 'esupo-1.wav', 'b': 'espo-1.wav', 'correct': 'a', 'item_a': 'esupo', 'item_x': 'esupo', 'item_b': 'espo'},{'task': 'perception', 'item_id': 4, 'type': 'target', 'a': 'espo-1.wav', 'x': 'esupo-1.wav', 'b': 'esupo-1.wav', 'correct': 'b', 'item_a': 'espo', 'item_x': 'esupo', 'item_b': 'esupo'},{'task': 'perception', 'item_id': 5, 'type': 'target', 'a': 'ezbo-1.wav', 'x': 'ezbo-1.wav', 'b': 'ezubo-1.wav', 'correct': 'a', 'item_a': 'ezbo', 'item_x': 'ezbo', 'item_b': 'ezubo'},{'task': 'perception', 'item_id': 6, 'type': 'target', 'a': 'ezubo-1.wav', 'x': 'ezbo-1.wav', 'b': 'ezbo-1.wav', 'correct': 'b', 'item_a': 'ezubo', 'item_x': 'ezbo', 'item_b': 'ezbo'},{'task': 'perception', 'item_id': 7, 'type': 'target', 'a': 'ezubo-1.wav', 'x': 'ezubo-1.wav', 'b': 'ezbo-1.wav', 'correct': 'a', 'item_a': 'ezubo', 'item_x': 'ezubo', 'item_b': 'ezbo'},{'task': 'perception', 'item_id': 8, 'type': 'target', 'a': 'ezbo-1.wav', 'x': 'ezubo-1.wav', 'b': 'ezubo-1.wav', 'correct': 'b', 'item_a': 'ezbo', 'item_x': 'ezubo', 'item_b': 'ezubo'},{'task': 'perception', 'item_id': 9, 'type': 'target', 'a': 'ekto-1.wav', 'x': 'ekto-1.wav', 'b': 'ekuto-1.wav', 'correct': 'a', 'item_a': 'ekto', 'item_x': 'ekto', 'item_b': 'ekuto'},{'task': 'perception', 'item_id': 10, 'type': 'target', 'a': 'ekuto-1.wav', 'x': 'ekto-1.wav', 'b': 'ekto-1.wav', 'correct': 'b', 'item_a': 'ekuto', 'item_x': 'ekto', 'item_b': 'ekto'},{'task': 'perception', 'item_id': 11, 'type': 'target', 'a': 'ekuto-1.wav', 'x': 'ekuto-1.wav', 'b': 'ekto-1.wav', 'correct': 'a', 'item_a': 'ekuto', 'item_x': 'ekuto', 'item_b': 'ekto'},{'task': 'perception', 'item_id': 12, 'type': 'target', 'a': 'ekto-1.wav', 'x': 'ekuto-1.wav', 'b': 'ekuto-1.wav', 'correct': 'b', 'item_a': 'ekto', 'item_x': 'ekuto', 'item_b': 'ekuto'},{'task': 'perception', 'item_id': 13, 'type': 'target', 'a': 'egdo-1.wav', 'x': 'egdo-1.wav', 'b': 'egudo-1.wav', 'correct': 'a', 'item_a': 'egdo', 'item_x': 'egdo', 'item_b': 'egudo'},{'task': 'perception', 'item_id': 14, 'type': 'target', 'a': 'egudo-1.wav', 'x': 'egdo-1.wav', 'b': 'egdo-1.wav', 'correct': 'b', 'item_a': 'egudo', 'item_x': 'egdo', 'item_b': 'egdo'},{'task': 'perception', 'item_id': 15, 'type': 'target', 'a': 'egudo-1.wav', 'x': 'egudo-1.wav', 'b': 'egdo-1.wav', 'correct': 'a', 'item_a': 'egudo', 'item_x': 'egudo', 'item_b': 'egdo'},{'task': 'perception', 'item_id': 16, 'type': 'target', 'a': 'egdo-1.wav', 'x': 'egudo-1.wav', 'b': 'egudo-1.wav', 'correct': 'b', 'item_a': 'egdo', 'item_x': 'egudo', 'item_b': 'egudo'},{'task': 'perception', 'item_id': 17, 'type': 'target', 'a': 'epso-1.wav', 'x': 'epso-1.wav', 'b': 'epuso-1.wav', 'correct': 'a', 'item_a': 'epso', 'item_x': 'epso', 'item_b': 'epuso'},{'task': 'perception', 'item_id': 18, 'type': 'target', 'a': 'epuso-1.wav', 'x': 'epso-1.wav', 'b': 'epso-1.wav', 'correct': 'b', 'item_a': 'epuso', 'item_x': 'epso', 'item_b': 'epso'},{'task': 'perception', 'item_id': 19, 'type': 'target', 'a': 'epuso-1.wav', 'x': 'epuso-1.wav', 'b': 'epso-1.wav', 'correct': 'a', 'item_a': 'epuso', 'item_x': 'epuso', 'item_b': 'epso'},{'task': 'perception', 'item_id': 20, 'type': 'target', 'a': 'epso-1.wav', 'x': 'epuso-1.wav', 'b': 'epuso-1.wav', 'correct': 'b', 'item_a': 'epso', 'item_x': 'epuso', 'item_b': 'epuso'},{'task': 'perception', 'item_id': 21, 'type': 'target', 'a': 'ebzo-1.wav', 'x': 'ebzo-1.wav', 'b': 'ebuzo-1.wav', 'correct': 'a', 'item_a': 'ebzo', 'item_x': 'ebzo', 'item_b': 'ebuzo'},{'task': 'perception', 'item_id': 22, 'type': 'target', 'a': 'ebuzo-1.wav', 'x': 'ebzo-1.wav', 'b': 'ebzo-1.wav', 'correct': 'b', 'item_a': 'ebuzo', 'item_x': 'ebzo', 'item_b': 'ebzo'},{'task': 'perception', 'item_id': 23, 'type': 'target', 'a': 'ebuzo-1.wav', 'x': 'ebuzo-1.wav', 'b': 'ebzo-1.wav', 'correct': 'a', 'item_a': 'ebuzo', 'item_x': 'ebuzo', 'item_b': 'ebzo'},{'task': 'perception', 'item_id': 24, 'type': 'target', 'a': 'ebzo-1.wav', 'x': 'ebuzo-1.wav', 'b': 'ebuzo-1.wav', 'correct': 'b', 'item_a': 'ebzo', 'item_x': 'ebuzo', 'item_b': 'ebuzo'},{'task': 'perception', 'item_id': 25, 'type': 'target', 'a': 'etsko-1.wav', 'x': 'etsko-1.wav', 'b': 'etsuko-1.wav', 'correct': 'a', 'item_a': 'etsko', 'item_x': 'etsko', 'item_b': 'etsuko'},{'task': 'perception', 'item_id': 26, 'type': 'target', 'a': 'etsuko-1.wav', 'x': 'etsko-1.wav', 'b': 'etsko-1.wav', 'correct': 'b', 'item_a': 'etsuko', 'item_x': 'etsko', 'item_b': 'etsko'},{'task': 'perception', 'item_id': 27, 'type': 'target', 'a': 'etsuko-1.wav', 'x': 'etsuko-1.wav', 'b': 'etsko-1.wav', 'correct': 'a', 'item_a': 'etsuko', 'item_x': 'etsuko', 'item_b': 'etsko'},{'task': 'perception', 'item_id': 28, 'type': 'target', 'a': 'etsko-1.wav', 'x': 'etsuko-1.wav', 'b': 'etsuko-1.wav', 'correct': 'b', 'item_a': 'etsko', 'item_x': 'etsuko', 'item_b': 'etsuko'},{'task': 'perception', 'item_id': 29, 'type': 'target', 'a': 'edzgo-1.wav', 'x': 'edzgo-1.wav', 'b': 'edzugo-1.wav', 'correct': 'a', 'item_a': 'edzgo', 'item_x': 'edzgo', 'item_b': 'edzugo'},{'task': 'perception', 'item_id': 30, 'type': 'target', 'a': 'edzugo-1.wav', 'x': 'edzgo-1.wav', 'b': 'edzgo-1.wav', 'correct': 'b', 'item_a': 'edzugo', 'item_x': 'edzgo', 'item_b': 'edzgo'},{'task': 'perception', 'item_id': 31, 'type': 'target', 'a': 'edzugo-1.wav', 'x': 'edzugo-1.wav', 'b': 'edzgo-1.wav', 'correct': 'a', 'item_a': 'edzugo', 'item_x': 'edzugo', 'item_b': 'edzgo'},{'task': 'perception', 'item_id': 32, 'type': 'target', 'a': 'edzgo-1.wav', 'x': 'edzugo-1.wav', 'b': 'edzugo-1.wav', 'correct': 'b', 'item_a': 'edzgo', 'item_x': 'edzugo', 'item_b': 'edzugo'},{'task': 'perception', 'item_id': 33, 'type': 'filler', 'a': 'ets-L_-1.wav', 'x': 'ets-L_-1.wav', 'b': 'etsu-HL-1.wav', 'correct': 'a', 'item_a': 'ets-L_', 'item_x': 'ets-L_', 'item_b': 'etsu-HL'},{'task': 'perception', 'item_id': 34, 'type': 'filler', 'a': 'etsu-HL-1.wav', 'x': 'ets-L_-1.wav', 'b': 'ets-L_-1.wav', 'correct': 'b', 'item_a': 'etsu-HL', 'item_x': 'ets-L_', 'item_b': 'ets-L_'},{'task': 'perception', 'item_id': 35, 'type': 'filler', 'a': 'ets-L_-1.wav', 'x': 'ets-L_-1.wav', 'b': 'etsu-LL-1.wav', 'correct': 'a', 'item_a': 'ets-L_', 'item_x': 'ets-L_', 'item_b': 'etsu-LL'},{'task': 'perception', 'item_id': 36, 'type': 'filler', 'a': 'etsu-LL-1.wav', 'x': 'ets-L_-1.wav', 'b': 'ets-L_-1.wav', 'correct': 'b', 'item_a': 'etsu-LL', 'item_x': 'ets-L_', 'item_b': 'ets-L_'},{'task': 'perception', 'item_id': 37, 'type': 'filler', 'a': 'etsto-H_L-1.wav', 'x': 'etsto-H_L-1.wav', 'b': 'etsuto-HLL-1.wav', 'correct': 'a', 'item_a': 'etsto-H_L', 'item_x': 'etsto-H_L', 'item_b': 'etsuto-HLL'},{'task': 'perception', 'item_id': 38, 'type': 'filler', 'a': 'etsuto-HLL-1.wav', 'x': 'etsto-H_L-1.wav', 'b': 'etsto-H_L-1.wav', 'correct': 'b', 'item_a': 'etsuto-HLL', 'item_x': 'etsto-H_L', 'item_b': 'etsto-H_L'},{'task': 'perception', 'item_id': 39, 'type': 'filler', 'a': 'etsto-H_L-1.wav', 'x': 'etsto-H_L-1.wav', 'b': 'etsuto-HHL-1.wav', 'correct': 'a', 'item_a': 'etsto-H_L', 'item_x': 'etsto-H_L', 'item_b': 'etsuto-HHL'},{'task': 'perception', 'item_id': 40, 'type': 'filler', 'a': 'etsuto-HHL-1.wav', 'x': 'etsto-H_L-1.wav', 'b': 'etsto-H_L-1.wav', 'correct': 'b', 'item_a': 'etsuto-HHL', 'item_x': 'etsto-H_L', 'item_b': 'etsto-H_L'},{'task': 'perception', 'item_id': 41, 'type': 'filler', 'a': 'etsto-L_H-1.wav', 'x': 'etsto-L_H-1.wav', 'b': 'etsuto-LLH-1.wav', 'correct': 'a', 'item_a': 'etsto-L_H', 'item_x': 'etsto-L_H', 'item_b': 'etsuto-LLH'},{'task': 'perception', 'item_id': 42, 'type': 'filler', 'a': 'etsuto-LLH-1.wav', 'x': 'etsto-L_H-1.wav', 'b': 'etsto-L_H-1.wav', 'correct': 'b', 'item_a': 'etsuto-LLH', 'item_x': 'etsto-L_H', 'item_b': 'etsto-L_H'},{'task': 'perception', 'item_id': 43, 'type': 'filler', 'a': 'etsto-L_H-1.wav', 'x': 'etsto-L_H-1.wav', 'b': 'etsuto-LHH-1.wav', 'correct': 'a', 'item_a': 'etsto-L_H', 'item_x': 'etsto-L_H', 'item_b': 'etsuto-LHH'},{'task': 'perception', 'item_id': 44, 'type': 'filler', 'a': 'etsuto-LHH-1.wav', 'x': 'etsto-L_H-1.wav', 'b': 'etsto-L_H-1.wav', 'correct': 'b', 'item_a': 'etsuto-LHH', 'item_x': 'etsto-L_H', 'item_b': 'etsto-L_H'},{'task': 'perception', 'item_id': 45, 'type': 'filler', 'a': 'es-L_-1.wav', 'x': 'es-L_-1.wav', 'b': 'esu-HL-1.wav', 'correct': 'a', 'item_a': 'es-L_', 'item_x': 'es-L_', 'item_b': 'esu-HL'},{'task': 'perception', 'item_id': 46, 'type': 'filler', 'a': 'esu-HL-1.wav', 'x': 'es-L_-1.wav', 'b': 'es-L_-1.wav', 'correct': 'b', 'item_a': 'esu-HL', 'item_x': 'es-L_', 'item_b': 'es-L_'},{'task': 'perception', 'item_id': 47, 'type': 'filler', 'a': 'es-L_-1.wav', 'x': 'es-L_-1.wav', 'b': 'esu-LL-1.wav', 'correct': 'a', 'item_a': 'es-L_', 'item_x': 'es-L_', 'item_b': 'esu-LL'},{'task': 'perception', 'item_id': 48, 'type': 'filler', 'a': 'esu-LL-1.wav', 'x': 'es-L_-1.wav', 'b': 'es-L_-1.wav', 'correct': 'b', 'item_a': 'esu-LL', 'item_x': 'es-L_', 'item_b': 'es-L_'},{'task': 'perception', 'item_id': 49, 'type': 'filler', 'a': 'esko-H_L-1.wav', 'x': 'esko-H_L-1.wav', 'b': 'esuko-HLL-1.wav', 'correct': 'a', 'item_a': 'esko-H_L', 'item_x': 'esko-H_L', 'item_b': 'esuko-HLL'},{'task': 'perception', 'item_id': 50, 'type': 'filler', 'a': 'esuko-HLL-1.wav', 'x': 'esko-H_L-1.wav', 'b': 'esko-H_L-1.wav', 'correct': 'b', 'item_a': 'esuko-HLL', 'item_x': 'esko-H_L', 'item_b': 'esko-H_L'},{'task': 'perception', 'item_id': 51, 'type': 'filler', 'a': 'esko-H_L-1.wav', 'x': 'esko-H_L-1.wav', 'b': 'esuko-HHL-1.wav', 'correct': 'a', 'item_a': 'esko-H_L', 'item_x': 'esko-H_L', 'item_b': 'esuko-HHL'},{'task': 'perception', 'item_id': 52, 'type': 'filler', 'a': 'esuko-HHL-1.wav', 'x': 'esko-H_L-1.wav', 'b': 'esko-H_L-1.wav', 'correct': 'b', 'item_a': 'esuko-HHL', 'item_x': 'esko-H_L', 'item_b': 'esko-H_L'},{'task': 'perception', 'item_id': 53, 'type': 'filler', 'a': 'esko-L_H-1.wav', 'x': 'esko-L_H-1.wav', 'b': 'esuko-LLH-1.wav', 'correct': 'a', 'item_a': 'esko-L_H', 'item_x': 'esko-L_H', 'item_b': 'esuko-LLH'},{'task': 'perception', 'item_id': 54, 'type': 'filler', 'a': 'esuko-LLH-1.wav', 'x': 'esko-L_H-1.wav', 'b': 'esko-L_H-1.wav', 'correct': 'b', 'item_a': 'esuko-LLH', 'item_x': 'esko-L_H', 'item_b': 'esko-L_H'},{'task': 'perception', 'item_id': 55, 'type': 'filler', 'a': 'esko-L_H-1.wav', 'x': 'esko-L_H-1.wav', 'b': 'esuko-LHH-1.wav', 'correct': 'a', 'item_a': 'esko-L_H', 'item_x': 'esko-L_H', 'item_b': 'esuko-LHH'},{'task': 'perception', 'item_id': 56, 'type': 'filler', 'a': 'esuko-LHH-1.wav', 'x': 'esko-L_H-1.wav', 'b': 'esko-L_H-1.wav', 'correct': 'b', 'item_a': 'esuko-LHH', 'item_x': 'esko-L_H', 'item_b': 'esko-L_H'}];
var production_list = [{'task': 'production', 'item_id': 1, 'type': 'target', 'read': '句読点 (くとうてん)'},{'task': 'production', 'item_id': 2, 'type': 'target', 'read': '悪天候 (あくてんこう)'},{'task': 'production', 'item_id': 3, 'type': 'target', 'read': 'エスペラント (えすぺらんと)'},{'task': 'production', 'item_id': 4, 'type': 'target', 'read': 'スポーツ (すぽーつ)'},{'task': 'production', 'item_id': 5, 'type': 'target', 'read': 'エプソン (えぷそん)'},{'task': 'production', 'item_id': 6, 'type': 'target', 'read': '釜山名物 (ぷさんめいぶつ)'},{'task': 'production', 'item_id': 7, 'type': 'target', 'read': 'お使い (おつかい)'},{'task': 'production', 'item_id': 8, 'type': 'target', 'read': 'ツケ払い (つけばらい)'},{'task': 'production', 'item_id': 9, 'type': 'filler', 'read': '北上 (きたかみ)'},{'task': 'production', 'item_id': 10, 'type': 'filler', 'read': '効き目 (ききめ)'},{'task': 'production', 'item_id': 11, 'type': 'filler', 'read': '鹿 (しか)'},{'task': 'production', 'item_id': 12, 'type': 'filler', 'read': '意識 (いしき)'},{'task': 'production', 'item_id': 13, 'type': 'filler', 'read': '既成 (きせい)'},{'task': 'production', 'item_id': 14, 'type': 'filler', 'read': '着過ぎる (きすぎる)'},{'task': 'production', 'item_id': 15, 'type': 'filler', 'read': '遅刻 (ちこく)'},{'task': 'production', 'item_id': 16, 'type': 'filler', 'read': '竹輪 (ちくわ)'},{'task': 'production', 'item_id': 17, 'type': 'filler', 'read': '心 (こころ)'},{'task': 'production', 'item_id': 18, 'type': 'filler', 'read': '小瓶 (こびん)'},{'task': 'production', 'item_id': 19, 'type': 'filler', 'read': '磯辺焼き (いそべやき)'},{'task': 'production', 'item_id': 20, 'type': 'filler', 'read': 'お蕎麦 (おそば)'},{'task': 'production', 'item_id': 21, 'type': 'filler', 'read': '大都市 (だいとし)'},{'task': 'production', 'item_id': 22, 'type': 'filler', 'read': 'コスト (こすと)'},{'task': 'production', 'item_id': 23, 'type': 'filler', 'read': 'おちょこ (おちょこ)'},{'task': 'production', 'item_id': 24, 'type': 'filler', 'read': '貯金 (ちょきん)'}];
var preload = {
    type: 'preload',
    audio: list_audio_preload,
}

var axb_instructions_practice = {
  type: "html-keyboard-response",
  stimulus: `
    <p>キーを押すと練習課題に移ってしまうので、
    以下のお願いを全て読んでからキーを押してください。</p>
    <p>この実験の各課題では A->X->B という順序で
    3つの音を聞いてもらいます。
    そしてX、つまり2つ目の音が似ているのはAかBかを
    答えていただきます。</p>
    <p>キーを押すと練習課題を2問呈示いたします。
    </p>
  `,
};

//Define Procedure for AXB
var fixation = {
  type: 'html-keyboard-response',
  stimulus: '<div style="font-size:60px;">+</div>',
  choices: jsPsych.NO_KEYS,
  trial_duration: 1000,
}
var trial_a = {
    type: 'audio-keyboard-response',
    stimulus: jsPsych.timelineVariable('a'),
    choices: jsPsych.NO_KEYS,
    trial_ends_after_audio: true,
    post_trial_gap: 200,
};
var trial_x = {
    type: 'audio-keyboard-response',
    stimulus: jsPsych.timelineVariable('x'),
    choices: jsPsych.NO_KEYS,
    trial_ends_after_audio: true,
    post_trial_gap: 200,
};
var trial_b = {
    type: 'audio-keyboard-response',
    stimulus: jsPsych.timelineVariable('b'),
    choices: jsPsych.NO_KEYS,
    trial_ends_after_audio: true,
};
var question = {
    type: 'html-keyboard-response',
    stimulus: '音声呈示は A->X->B の順でした。',
    choices: ['a', 'b'],
    prompt: "<p>Xの音がAと同じなら'a'を押し、Bと同じなら'b'を押してください。</p>",
    data: {
        index: jsPsych.timelineVariable('index'),
        latin: jsPsych.timelineVariable('latin'),
        task:  jsPsych.timelineVariable('task'),
        c1_duration:  jsPsych.timelineVariable('c1_duration'),
        cond_context:  jsPsych.timelineVariable('cond_context'),
        cond_prev:  jsPsych.timelineVariable('cond_prev'),
        token_sequence: jsPsych.timelineVariable('token_sequence'),
        speaker_sequence: jsPsych.timelineVariable('speaker_sequence'),
        correct_response: jsPsych.timelineVariable('correct_response'),
    },
    on_finish: function(data){
      data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
    },
};
var feedback = {
    type: 'html-keyboard-response',
    stimulus: function(){
        let last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
        if (last_trial_correct) { return "<p>正解です。</p>"; }
        else { return "<p>不正解です。</p>"; }
    },
    choices: [' '],
    prompt: "次の問題に進む場合はスペースキーを押してください。",
};
var rest = {
    type: 'html-keyboard-response',
    // stimulus: '<p>Running</p>',
    stimulus: function(){
        var fool_proof = "<p>以下のアイテム情報は本来見えるべきではありません。".concat(
                         "もし本実験で見えてしまっている場合はお手数ですが実験実施者にご連絡ください。<p>");
        let last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
        var is_correct = last_trial_correct? "正解<br>":  "不正解<br>";
        var pair = "pair: ".concat(jsPsych.timelineVariable('pair_str'), "<br>");
        var a = "a: ".concat(jsPsych.timelineVariable('a'), "<br>");
        var x = "x: ".concat(jsPsych.timelineVariable('x'), "<br>");
        var b = "b: ".concat(jsPsych.timelineVariable('b'), "<br>");
        return "".concat(fool_proof, pair, is_correct, a, x, b);
    },
    choices: [' '],
    prompt: "次の問題に進む場合はスペースキーを押してください。",
};

//Practice
var practice_stimuli = [
  { a: "32.mp3", x:"33.mp3", b:"33.mp3", cond_str: "b", correct_response: 'b', task: "axb-practice"},
  { a: "33.mp3", x:"33.mp3", b:"32.mp3", cond_str: "a", correct_response: 'a', task: "axb-practice"},
];
var axb_practice = {
  timeline: [fixation, trial_a, trial_x, trial_b, question, feedback],
  timeline_variables: practice_stimuli
}

var axb_instructions = {
  type: "html-keyboard-response",
  stimulus: `
    <p>今流れたものは機械的な音ですが、
    実際に流れる音は3人の人が読み上げる音声です。
    さきほどのものより違いがかなり微細なので、
    注意して聞き分けてみてください。</p>
    <p>また、今の練習課題では回答の正誤を表示しましたが、
    本番では表示しません。</p>
    <p>キーの押下で本番の呈示を開始いたします。</p>
  `,
};

var perception_list = jsPsych.randomization.repeat(perception_list, 1);

var axb = {
  timeline: [fixation, trial_a, trial_x, trial_b, question, rest],
  timeline_variables: perception_list
}

var axb_end = {
  type: "html-keyboard-response",
  stimulus: `
    <p>
    弁別課題はこれで終了となります。
    お好きなキーを押して次に進んでください。
    </p>
  `,
};

// informed consent
// https://www.jspsych.org/plugins/jspsych-external-html/
var check_consent = function(elem) {
  if (document.getElementById('consent_checkbox').checked) {
    return true;
  }
  else {
    alert("同意して実験に参加していただける場合はチェックボックスをクリックしてください。");
    return false;
  }
  return false;
};
var informed_consent = {
  type:'external-html',
  url: "informed_consent.html",
  cont_btn: "start",
  check_fn: check_consent
};
// PRODUCTION EXPERIMENT
var production_instructions_practice = {
  type: "html-keyboard-response",
  stimulus: `
    <p>キーを押すと練習課題に移ってしまうので、<br>
    以下のお願いを全て読んでからキーを押してください。<br><br>
    最初の産出実験では、一番上に表示される単語を<br>
    標準語で2回ずつ読み上げていただきます。<br> <br>
    キーを押すと2セットの練習課題に移ります。<br>
    必要に応じてマイクの許可をお願いいたします。</p>
    `,
};

var record = {
    type: 'html-audio-response_modified',
    stimulus: jsPsych.timelineVariable('read'),
    prompt: `<br>
    大きな声ではっきりと、<br>
    標準語で上の単語を2回読み上げたらspaceキーを押してください。<br>
    再生ボタンを押して確認し、上手く録音できた場合は Sounds good! で次に進み、<br>
    上手く録音できなかった場合は Retry を押してください。<br>
    小さな声しか出せない環境での実施は想定されておらず、<br>
    その後の分析で非常に困りますので場所が不適切な場合は移動をお願いいたします。<br>
    ※丸が赤で満たされている時、録音しています。
    `, 
    buffer_length: 60000,
    manually_end_recording_key: ['space'],
    data: {
        type:  jsPsych.timelineVariable('type'),
        item_id: jsPsych.timelineVariable('item_id'),
        read:  jsPsych.timelineVariable('read'),
    },
    on_finish: function(data){
      data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
    },
};
var production_list_practice = [
  {type: "production", item_id: -1, read: "銀河", },
  {type: "production", item_id: -2, read: "アップル"},
];
var production_practice = {
  timeline: [record],
  timeline_variables: production_list_practice
}

var production_instructions = {
  type: "html-keyboard-response",
  stimulus: `
    <p>以上で練習は終わりです。もしもう一度練習を希望される場合は<br>
    本画面を閉じてから再度同じURLを開いてください。<br><br>
    キーを押すと2セットの本番の産出課題に移ります。<br>
    丸が赤で満たされているときは録音しています。<br>
    ※途中で間違えて次に進んでしまったとしても、<br>
    そこまで致命的な問題にはなりません。<br>
    </p>
    `,
};

var production_list = jsPsych.randomization.repeat(production_list, 1);
var production = {
  timeline: [record],
  timeline_variables: production_list
}

var production_end = {
  type: "html-keyboard-response",
  stimulus: `
    <p>
    産出課題はこれで終了となります。
    お好きなキーを押して次に進んでください。
    </p>
  `,
};
// TIMELINE
var timeline = [];

// preload
timeline.push(preload);

timeline.push(informed_consent);

// produciotn
timeline.push(production_instructions_practice);
timeline.push(production_practice);
timeline.push(production_instructions);
timeline.push(production);
timeline.push(production_end);

// produciotn
timeline.push(axb_instructions_practice);
timeline.push(axb_practice);
timeline.push(axb_instructions);
timeline.push(axb);
timeline.push(axb_end);

// categorize

jsPsych.init({
    timeline: timeline,
    // on_finish: function(){
    //     jsPsych.data.displayData();
    // }
});
